<?php
session_start();

include "db_connection.php";
?>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=search"
    />
    <title>McCOMPRA-MasCARRO | Quantum Harmonizing</title>
  </head>
  <body>
    <nav class="px-5 pt-3">
      <div class="flex justify-between items-center flex-row">
        <div class="flex items-center justify-start">
          <h1
            style="
              font-family: 'Hind Vadodara', sans-serif;
              letter-spacing: -1px;
              font-size: 2.2rem;
              color: #346734;
              transform: scaleX(0.75);
              transform-origin: left;
            "
          >
            McCOMPRA-MasCARRO
          </h1>
          <p class="text-xs ml-[-5.5rem] mt-5 text-[#346734]">&#xA9;</p>
        </div>
        <div
          class="flex justify-center items-start flex-1 mx-4 font-bold"
          id="searchBar"
        >
          <div
            class="border-1 border-gray-500 w-3/5 flex flex-row justify-between font-normal"
          >
            <input
              type="text"
              placeholder="Search"
              class="border-0 focus:outline-none px-1 py-1"
            />
            <button class="text-xs mr-1 mt-1">
              <span class="material-symbols-outlined text-gray-500"
                >search</span
              >
            </button>
          </div>
        </div>
        <div class="flex justify-center items-center flex-col">
          <ul class="flex space-x-4 text-xs text-gray-600">
            <li><a href="#">(630) 833-0300</a></li>
            <li>|</li>
            <li><a href="#"> Email Us</a></li>
            <li>|</li>
            <li>
              <a href="#" class="hover:underline">Log in â–¼</a>
            </li>
          </ul>
          <div class="flex justify-center items-center">
            <button class="text-[#346734] font-bold px-4 py-2 rounded-md">
              ORDER
            </button>
            <button class="text-[#346734] font-bold px-4 py-2 rounded-md">
              ORDER HISTORY
            </button>
          </div>
        </div>
      </div>
    </nav>
    <hr class="border-yellow-400 border-[1px]" />
    <section class="flex justify-start items-start">
      <aside
        id="sideBar"
        class="w-1/7 h-screen border-r border-gray-400 m-2 mr-5 text-nowrap"
      >
        <div class="flex justify-start items-start flex-col px-3">
          <header class="text-sm text-nowrap font-regular mb-1">
            Choose a Category
          </header>
          <hr class="border-[#346734] w-full" />
          <ul
            class="flex w-full space-x-4 space-y-2 flex-col text-xs mt-2 text-gray-800 [&>*]:hover:bg-yellow-100 [&>*]:hover:cursor-pointer [&>*]:hover:underline [&>*]:pb-2 [&>*]:active:bg-yellow-300 [&>*]:active:underline"
          >
          <?php
              $categories = $conn->query("SELECT * FROM categories");
              $selectedCategory = isset($_GET['category']) ? $_GET['category'] : 'Quantum Harmonizing';
              $_SESSION['selectedCategory'] = $selectedCategory;
              
              foreach ($categories as $category) {
                $isActive = ($category['category'] === $selectedCategory) ? 'bg-yellow-100' : '';
                echo "<li class='{$isActive}'><a href='?category=" . urlencode($category['category']) . "'>{$category['category']}</a></li>";
              }
            ?>
          </ul>
        </div>
      </aside>
      <main id="detailedView" class="w-full m-2">
        <div class="flex justify-start items-start flex-col">
          <header class="text-sm font-regular mb-1">All categories</header>
          <hr class="border-[#346734] w-full" />
          <div class="flex justify-start items-start flex-col">
            <h1 class="text-lg font-semibold text-gray-500">
              Quantum Harmonizing
            </h1>
          </div>
          <hr class="w-full" />
          <div
            class="flex justify-start items-start my-3 gap-3 [&>*]:border-1 [&>*]:border-gray-300 [&>*]:rounded-xs [&>*]:w-[25rem] [&>*>div]:flex [&>*>div]:flex-row [&>*>div]:justify-start [&>*>div]:items-center [&>*>div]:p-3 [&>*>div]:gap-3 [&>*>div>div]:flex [&>*>div>div]:flex-col [&>*>div>div>button]:ml-30 [&>*>div>div]:gap-2 [&>*>div>img]:w-[6.5rem] [&>*>div>img]:h-[6.5rem] [&>*>div>h3]:text-nowrap [&>*>div>h3]:text-gray-500 [&>*>div>div>p]:text-sm [&>*>div>div>p]:text-gray-600 [&>*>div>div>p]:text-wrap [&>*>div>div>button]:bg-[#346734] [&>*>div>div>button]:text-xs [&>*>div>div>button]:text-white [&>*>div>div>button]:font-semibold [&>*>div>div>button]:px-2 [&>*>div>div>button]:py-1 [&>*>div>div>button]:p-[0.08rem] [&>*>div>div>button]:w-[7rem] [&>*>div>div>button]:rounded-xs [&>*>div>div>button]:hover:bg-green-700 [&>*>div>div>button]:active:rounded-sm"
          >
            <?php
            require_once 'db_connection.php';

            $selectedCategory = isset($_SESSION['selectedCategory']) ? $_SESSION['selectedCategory'] : 'Quantum Harmonizing';
            $selectedSubcategory = isset($_GET['subcategory']) ? $_GET['subcategory'] : '';
            $products = $conn->query("SELECT * FROM products WHERE subcategory = '" . 
                $conn->real_escape_string($selectedSubcategory) . "'");

            if ($products->num_rows > 0) {
                while($product = $products->fetch_assoc()) {
                    echo "<div>
                            <div>
                                <img alt='" . $product['name']. "'
                                     src='" . $product['imageURL']. "'/>
                                <div>
                                    <h3>" . $product['name']. "</h3>
                                    <p>" . $product['description']. "</p>
                                    <button>
                                        <p>ADD TO ORDER</p>
                                    </button>
                                </div>
                            </div>
                          </div>";
                }
            } else {
                echo "<p>No products found for this subcategory.</p>";
            }
            ?>
          </div>
        </div>
      </main>
    </section>
  </body>
</html>
